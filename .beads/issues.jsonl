{"id":"fullstack-boilerplate-35t","title":"Fix empty USlideover content on users page","description":"## Problem\n\nThe USlideover component on `/users` page opens but shows empty content when clicking a user row or \"Details\" menu item.\n\n## Root Cause\n\nContent is in the default slot, but Nuxt UI v4's `USlideover` requires content in the `#body` slot.\n\n**Note**: Same file correctly uses `#body` for `UDashboardPanel` at line 155 - this was simply an oversight.\n\n## Fix\n\nIn `apps/web/src/pages/users.vue`:\n\n1. Line 219: Wrap the existing `\u003cdiv v-if=\"selectedUser\"\u003e` in `\u003ctemplate #body\u003e`\n2. Line 285: Close the template after the `\u003c/div\u003e`\n\n**Current code (lines 214-286):**\n```vue\n\u003cUSlideover v-model:open=\"isDetailsOpen\"\u003e\n  \u003ctemplate #title\u003eUser Details\u003c/template\u003e\n  \n  \u003cdiv v-if=\"selectedUser\" class=\"space-y-6\"\u003e\n    \u003c!-- content directly in default slot - BROKEN --\u003e\n  \u003c/div\u003e\n\u003c/USlideover\u003e\n```\n\n**Fixed code:**\n```vue\n\u003cUSlideover v-model:open=\"isDetailsOpen\"\u003e\n  \u003ctemplate #title\u003eUser Details\u003c/template\u003e\n  \n  \u003ctemplate #body\u003e\n    \u003cdiv v-if=\"selectedUser\" class=\"space-y-6\"\u003e\n      \u003c!-- content in #body slot - WORKS --\u003e\n    \u003c/div\u003e\n  \u003c/template\u003e\n\u003c/USlideover\u003e\n```\n\n## Verification\n\n1. Run `pnpm dev` in `apps/web`\n2. Navigate to `/users` page\n3. Click a user row or \"Details\" from dropdown menu\n4. Confirm slideover displays user info (ID, Email, Name, Role, timestamps, etc.)\n5. Run test suite: `pnpm --filter web test`\n\n## References\n\n- Plan: `/Users/ilyat/.claude/plans/parsed-imagining-ember.md`\n- File: `apps/web/src/pages/users.vue` lines 214-286","status":"closed","priority":1,"issue_type":"bug","owner":"teterich.ilya@gmail.com","created_at":"2026-01-28T17:03:30.814796+03:00","created_by":"tiilyat","updated_at":"2026-01-28T17:08:06.781739+03:00","closed_at":"2026-01-28T17:08:06.781739+03:00","close_reason":"Closed"}
{"id":"fullstack-boilerplate-5id","title":"Create UserEditForm component with dirtyFields tracking","description":"## Context\nPlan: /Users/ilyat/.claude/plans/scalable-cuddling-crayon.md\n\nCreate a form component for editing user name, role, and password. Uses UForm's dirtyFields to emit only changed+non-empty values.\n\n## Implementation\nCreate apps/web/src/components/users/UserEditForm.vue\n\nProps: user: UserWithRole, isPending?: boolean\nEmits: save: { name?, role?, password? }, close: []\n\n- Form owns its own reactive state (not parent)\n- Template ref to UForm for accessing dirtyFields\n- Name: UInput (optional, empty = ignore)\n- Role: USelect with ['user', 'admin'] options\n- Password: UInput type='password', min 8 chars if filled\n- Zod schema with .or(z.literal('')) for optional password\n- Filter dirtyFields: emit only if dirty AND non-empty\n\nSee plan lines 167-240 for full implementation.\n\n## Acceptance Criteria\n- Component exists at apps/web/src/components/users/UserEditForm.vue\n- Form uses template ref for dirtyFields access\n- Only dirty+non-empty fields emitted on save\n- Password validation: min 8 chars when filled\n- Cancel/Save buttons with proper emits","status":"closed","priority":1,"issue_type":"task","owner":"teterich.ilya@gmail.com","created_at":"2026-01-28T18:48:57.20194+03:00","created_by":"tiilyat","updated_at":"2026-01-28T19:04:28.233581+03:00","closed_at":"2026-01-28T19:04:28.233581+03:00","close_reason":"Closed"}
{"id":"fullstack-boilerplate-67f","title":"Add integration tests for user edit feature","description":"## Summary\n\nWrite integration tests for the user edit slideover feature.\n\n**Plan**: apps/web/.claude/plans/floating-drifting-cerf.md\n**Depends on**: fullstack-boilerplate-sd9 (implementation)\n\n## Requirements\n\n1. **MSW handler**: Add handler for updateUser admin endpoint in the existing MSW setup (check apps/web/src/test/ or similar for existing MSW config pattern used by other tests).\n\n2. **Test scenarios**:\n   - Edit slideover opens when clicking Edit in dropdown menu\n   - Name field is pre-filled with current user name\n   - Save button is disabled initially (no changes)\n   - Save button enables after changing name\n   - Successful save shows success toast and closes slideover\n   - Failed save shows error toast\n   - Closing with unsaved changes triggers confirm dialog\n   - Closing without changes does not trigger confirm\n\n3. Run pnpm test in apps/web and ensure all tests pass.\n\n## Acceptance Criteria\n\n- All test scenarios above are covered\n- Tests pass with pnpm test\n- MSW handler correctly mocks the updateUser endpoint","status":"open","priority":2,"issue_type":"task","owner":"teterich.ilya@gmail.com","created_at":"2026-01-30T18:12:23.697625+03:00","created_by":"tiilyat","updated_at":"2026-01-30T18:12:23.697625+03:00","dependencies":[{"issue_id":"fullstack-boilerplate-67f","depends_on_id":"fullstack-boilerplate-sd9","type":"blocks","created_at":"2026-01-30T18:12:23.698922+03:00","created_by":"tiilyat"}]}
{"id":"fullstack-boilerplate-9iy","title":"Add MSW mocks for updateUser, setRole, setUserPassword","description":"## Context\nPlan: /Users/ilyat/.claude/plans/scalable-cuddling-crayon.md\n\nAdd MSW handlers for the three admin API methods used by user editing.\n\n## Implementation\nUpdate apps/web/src/testing/mocks/handlers/admin.ts\n\nAdd URL constants (after line 6):\nexport const updateUserURL = `${import.meta.env.VITE_API_URL}/api/auth/admin/update-user`\nexport const setRoleURL = `${import.meta.env.VITE_API_URL}/api/auth/admin/set-role`\nexport const setUserPasswordURL = `${import.meta.env.VITE_API_URL}/api/auth/set-user-password`\n\nAdd handlers to adminHandlers array:\nhttp.post(updateUserURL, async ({ request }) =\u003e {\n  const body = await request.json()\n  return HttpResponse.json({ user: createUser({ name: body.data.name }) })\n})\n\nhttp.post(setRoleURL, async ({ request }) =\u003e {\n  const body = await request.json()\n  return HttpResponse.json({ user: createUser({ role: body.role }) })\n})\n\nhttp.post(setUserPasswordURL, async () =\u003e {\n  return HttpResponse.json({ status: true })\n})\n\n## Acceptance Criteria\n- Three new URL constants exported\n- Three handlers added to adminHandlers array\n- Handlers follow existing pattern (banUserURL, unbanUserURL)\n- Uses createUser factory for responses","status":"closed","priority":1,"issue_type":"task","owner":"teterich.ilya@gmail.com","created_at":"2026-01-28T18:49:04.892896+03:00","created_by":"tiilyat","updated_at":"2026-01-28T19:17:23.976198+03:00","closed_at":"2026-01-28T19:17:23.976198+03:00","close_reason":"Closed"}
{"id":"fullstack-boilerplate-a5z","title":"Add user details slideover to users page","description":"Add a \"Details\" action to the dropdown menu on the users page that opens a USlideover with comprehensive user information.\n\n## Context\nPlan: /Users/ilyat/.claude/plans/breezy-questing-narwhal.md\n\nEnhances apps/web/src/pages/users.vue with detailed user view.\n\n## Implementation\n\n### 1. State management (after line 14)\n```ts\nconst selectedUser = ref\u003cUserWithRole | null\u003e(null)\nconst isDetailsOpen = computed({\n  get: () =\u003e selectedUser.value !== null,\n  set: (v) =\u003e { if (!v) selectedUser.value = null }\n})\n```\n\n### 2. Update getUserActions (lines 62-87)\nAdd \"Details\" as first action group in both branches:\n```ts\n[{\n  label: 'Details',\n  icon: 'i-lucide-info',\n  onSelect: () =\u003e { selectedUser.value = user },\n}]\n```\n\n### 3. Add USlideover (after line 188)\nSections: Basic Info (id, email, name, role), Verification (emailVerified), Timestamps (createdAt, updatedAt), Ban Info (conditional: banReason, banExpires)\n\n### 4. Update factory (apps/web/src/testing/factories/user-factory.ts)\nAdd: banReason: null, banExpires: null\n\n### 5. Tests (apps/web/src/pages/users.test.ts)\n8 tests for slideover functionality\n\n## Acceptance Criteria\n- Details in dropdown for active/banned users\n- USlideover opens on click\n- All info sections display correctly\n- Ban info conditional\n- Dates use toLocaleDateString()\n- All tests pass\n\n## References\n- DB schema: apps/api/src/db/schemas/auth.ts:17-18\n- users.vue, users.test.ts, user-factory.ts","status":"closed","priority":2,"issue_type":"task","owner":"teterich.ilya@gmail.com","created_at":"2026-01-28T16:47:34.738142+03:00","created_by":"tiilyat","updated_at":"2026-01-28T16:55:49.329287+03:00","closed_at":"2026-01-28T16:55:49.329287+03:00","close_reason":"Closed"}
{"id":"fullstack-boilerplate-cax","title":"Create use-update-user composable for partial user updates","description":"## Context\nPlan: /Users/ilyat/.claude/plans/scalable-cuddling-crayon.md\n\nCreate a composable for updating user fields (name, role, password) with dirtyFields-based partial updates. Only updates fields that are both changed AND non-empty.\n\n## Implementation\nCreate apps/web/src/composables/queries/use-update-user.ts following the pattern of use-ban-user.ts\n\n- Accepts { userId, name?, role?, password? } params\n- Calls authClient.admin.updateUser() only if name provided\n- Calls authClient.admin.setRole() only if role provided\n- Calls authClient.admin.setUserPassword() only if password provided\n- Best-effort: stops on first error, previous updates persist\n- Invalidates ['admin-users'] query on success\n- Toast notifications for success/error\n\n## Acceptance Criteria\n- File exists at apps/web/src/composables/queries/use-update-user.ts\n- Exports default function matching useBanUser pattern\n- Only calls API for provided non-empty fields\n- Query invalidation on success\n- Toast notifications configured","status":"closed","priority":1,"issue_type":"task","owner":"teterich.ilya@gmail.com","created_at":"2026-01-28T18:48:52.481534+03:00","created_by":"tiilyat","updated_at":"2026-01-28T18:55:43.105274+03:00","closed_at":"2026-01-28T18:55:43.105274+03:00","close_reason":"Closed"}
{"id":"fullstack-boilerplate-ho6","title":"Update nuxt-ui overlays reference with #body slot example","description":"## Context\n\nThe local nuxt-ui skill reference at `.claude/skills/nuxt-ui/references/overlays.md` has a `USlideover` example that doesn't show the `#body` slot usage, which led to the bug fixed in fullstack-boilerplate-35t.\n\n## Task\n\nUpdate the overlays reference to show correct `#body` slot usage for `USlideover` component.\n\n## References\n\n- Plan: `/Users/ilyat/.claude/plans/parsed-imagining-ember.md`\n- Related issue: fullstack-boilerplate-35t (the bug this would have prevented)","status":"tombstone","priority":3,"issue_type":"task","owner":"teterich.ilya@gmail.com","created_at":"2026-01-28T17:04:06.840942+03:00","created_by":"tiilyat","updated_at":"2026-01-28T17:11:09.086677+03:00","deleted_at":"2026-01-28T17:11:09.086677+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"fullstack-boilerplate-sd9","title":"Add user edit slideover with name field","description":"## Summary\n\nAdd ability to edit user name via a slideover form on the users management page. Uses better-auth admin API authClient.admin.updateUser.\n\n**Plan**: apps/web/.claude/plans/floating-drifting-cerf.md\n\n## Requirements\n\n1. **Composable**: Create apps/web/src/composables/queries/use-update-user.ts following the exact pattern of apps/web/src/composables/queries/use-ban-user.ts. Call authClient.admin.updateUser({ userId, data: { name } }). Invalidate admin-users query on success. Toast on success/error.\n\n2. **Extract UserDetailsView**: Create apps/web/src/components/UserDetailsView.vue extracting lines 220-286 from apps/web/src/pages/users.vue. Accept prop user: UserWithRole | null. Update users.vue to use this component inside the existing Details slideover.\n\n3. **UserEditForm component**: Create apps/web/src/components/UserEditForm.vue with props user: UserWithRole, emits success and close. Zod schema for name validation (non-empty string). UForm with single name field pre-filled from user prop. Use useTemplateRef('form') to access UForm isDirty. Save button disabled when \\!isDirty || isPending. handleClose: if dirty, confirm('You have unsaved changes...') before emitting close. On submit success: emit success then close.\n\n4. **Integration in users.vue** (apps/web/src/pages/users.vue): Add selectedUserForEdit ref and isEditOpen computed (same pattern as existing Details slideover lines 15-21). Add Edit menu item to getUserActions() between Details and Ban/Unban. Add second USlideover with UserEditForm. On close set selectedUserForEdit = null.\n\n## Acceptance Criteria\n\n- Edit slideover opens from dropdown menu\n- Name field pre-filled with current name\n- Save disabled when no changes or while saving\n- Confirm dialog on close with unsaved changes\n- Toast on success/error\n- Users list refreshes after successful edit\n- Details slideover still works independently\n- pnpm lint:fix and pnpm type-check pass","status":"closed","priority":1,"issue_type":"task","owner":"teterich.ilya@gmail.com","created_at":"2026-01-30T18:12:08.726352+03:00","created_by":"tiilyat","updated_at":"2026-01-30T21:43:42.613786+03:00","closed_at":"2026-01-30T21:43:42.613786+03:00","close_reason":"Closed"}
{"id":"fullstack-boilerplate-u09","title":"Integrate user editing into users page (state, UI, handlers)","description":"## Context\nPlan: /Users/ilyat/.claude/plans/scalable-cuddling-crayon.md\n\nIntegrate the edit functionality into the existing users page.\n\n## Implementation\nUpdate apps/web/src/pages/users.vue\n\n1. Add imports (after line 9):\nimport UserEditForm from '@/components/users/UserEditForm.vue'\nimport useUpdateUser from '@/composables/queries/use-update-user'\n\n2. Add state (after line 21):\nconst editingUser = ref\u003cUserWithRole | null\u003e(null)\nconst isEditOpen = computed(() =\u003e editingUser.value !== null)\n\n3. Add composable (after line 27):\nconst { mutate: updateUser, isPending: isUpdating } = useUpdateUser()\n\n4. Add Edit to getUserActions (first group, after Details):\n{ label: 'Edit', icon: 'i-lucide-edit', onSelect: () =\u003e { editingUser.value = user } }\n\n5. Add #footer to Details slideover (before \u003c/USlideover\u003e ~line 288):\n\u003ctemplate #footer\u003e\n  \u003cdiv class=\"flex justify-end\"\u003e\n    \u003cUButton color=\"neutral\" @click=\"editingUser = selectedUser\"\u003eEdit User\u003c/UButton\u003e\n  \u003c/div\u003e\n\u003c/template\u003e\n\n6. Add Edit slideover (after Details slideover):\n\u003cUSlideover v-model:open=\"isEditOpen\"\u003e\n  \u003ctemplate #title\u003eEdit User\u003c/template\u003e\n  \u003ctemplate #body\u003e\n    \u003cUserEditForm v-if=\"editingUser\" :user=\"editingUser\" :is-pending=\"isUpdating\" @save=\"handleSaveEdit\" @close=\"editingUser = null\" /\u003e\n  \u003c/template\u003e\n\u003c/USlideover\u003e\n\n7. Add handler:\nfunction handleSaveEdit(values: { name?: string; role?: string; password?: string }) {\n  if (!editingUser.value) return\n  updateUser({ userId: editingUser.value.id, ...values })\n}\n\n## Acceptance Criteria\n- Edit appears in dropdown menu (after Details)\n- Edit button appears in Details slideover footer\n- Edit slideover opens with UserEditForm\n- handleSaveEdit guards against null editingUser\n- All additions follow existing code patterns","status":"closed","priority":1,"issue_type":"task","owner":"teterich.ilya@gmail.com","created_at":"2026-01-28T18:49:15.416053+03:00","created_by":"tiilyat","updated_at":"2026-01-28T19:26:54.301019+03:00","closed_at":"2026-01-28T19:26:54.301019+03:00","close_reason":"Closed"}
{"id":"fullstack-boilerplate-xs7","title":"Add comprehensive tests for user editing functionality","description":"## Context\nPlan: /Users/ilyat/.claude/plans/scalable-cuddling-crayon.md\n\nAdd tests for the user editing feature to verify dirtyFields behavior, validation, and API calls.\n\n## Implementation\nAdd new describe block \"Редактирование пользователя\" to apps/web/src/pages/users.test.ts (after line 981)\n\nTests to add (plan lines 267-283):\n1. Edit отображается в dropdown меню\n2. Edit кнопка отображается в Details slideover (#footer)\n3. Открытие формы редактирования\n4. Отображение текущих значений в форме\n5. Не изменённые поля не отправляются в API\n6. Пустой name = игнорируется (не обновляется)\n7. Валидация: короткий пароль (ошибка)\n8. Пустой пароль = не обновляется\n9. Обновление только имени\n10. Обновление только роли\n11. Обновление только пароля\n12. Обновление нескольких полей одновременно\n13. Отмена редактирования (Cancel)\n14. Сохранение с успешным ответом API\n15. Обработка ошибок API\n16. Toast уведомления\n\nUse existing test patterns from Ban/Unban tests (lines 376-695).\n\nImport new URL constants:\nimport { banUserURL, listUsersURL, unbanUserURL, updateUserURL, setRoleURL, setUserPasswordURL } from '@/testing/mocks/handlers/admin'\n\n## Acceptance Criteria\n- All 16 tests pass\n- Tests verify dirtyFields behavior (unchanged fields not sent)\n- Tests verify empty field filtering (empty name/password ignored)\n- Tests cover validation, success, error cases\n- Follow existing test patterns in the file","status":"tombstone","priority":2,"issue_type":"task","owner":"teterich.ilya@gmail.com","created_at":"2026-01-28T18:49:21.694604+03:00","created_by":"tiilyat","updated_at":"2026-01-30T21:48:18.632864+03:00","dependencies":[{"issue_id":"fullstack-boilerplate-xs7","depends_on_id":"fullstack-boilerplate-u09","type":"blocks","created_at":"2026-01-28T18:49:59.958662+03:00","created_by":"tiilyat"}],"deleted_at":"2026-01-30T21:48:18.632864+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
